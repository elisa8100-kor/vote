<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>도메인 추천 투표</title>

<!-- 디자인 그대로 유지 -->
<style>
  :root{
    --bg:#0d172f; --card:#182338; --muted:#b7c5d9; --accent:#8bd3ff;
    --glass: rgba(255,255,255,0.05);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family: "Noto Sans KR", Inter, system-ui; background:linear-gradient(180deg,#112240,#0d172f); color:#ecf6ff}
  .wrap{max-width:920px;margin:36px auto;padding:28px}
  header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));display:flex;align-items:center;justify-content:center;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
  h1{font-size:20px;margin:0}
  p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

  .card{background: rgba(255,255,255,0.03); border-radius:12px; padding:18px; margin-top:12px; border:1px solid rgba(255,255,255,0.05); box-shadow:0 10px 30px rgba(2,6,23,0.6);}

  form.options{display:flex;flex-direction:column;gap:12px}
  label.option{
    display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.05);
    transition:transform .18s;
  }
  label.option:hover{transform:translateY(-4px)}
  input[type="checkbox"]{width:18px;height:18px}
  .opt-text{flex:1;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .domain{font-weight:600}
  .price{color:var(--muted);font-size:13px}

  .controls{display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap}
  button{
    border:0;padding:10px 14px;border-radius:10px;background:rgba(255,255,255,0.05); color:#e9fbff;font-weight:600; cursor:pointer;
    border:1px solid rgba(255,255,255,0.06);
  }
  button[disabled]{opacity:0.5;cursor:not-allowed}
  .small{font-size:13px;padding:8px 10px}
  .muted{color:var(--muted);font-size:13px}

  .results{margin-top:18px;display:grid;gap:10px}
  .bar-wrap{display:flex;align-items:center;gap:12px}
  .bar-label{width:160px;font-size:14px}
  .bar{
    flex:1;background:rgba(255,255,255,0.08);border-radius:8px;padding:6px 8px;display:flex;align-items:center;gap:8px;
  }
  .bar-fill{height:14px;border-radius:6px;background:linear-gradient(90deg,var(--accent), rgba(139,211,255,0.6)); width:0%;}
  .bar-value{min-width:56px;text-align:right;color:var(--muted);font-size:13px}

  footer{margin-top:26px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">
        <svg width="42" height="42" viewBox="0 0 64 64" fill="none"><rect x="6" y="6" width="52" height="52" rx="10" fill="white" opacity="0.06"/><path d="M18 44 L26 24 L34 44 L42 20" stroke="white" stroke-width="3" stroke-linecap="round" opacity="0.8"/></svg>
      </div>
      <div>
        <h1>도메인 추천</h1>
        <p class="lead">복수 선택 가능 — 마음에 드는 도메인을 골라 투표해 주세요.</p>
      </div>
    </header>

    <section class="card">
      <form id="pollForm" class="options"></form>

      <div class="controls">
        <label class="muted"><input id="allowMulti" type="checkbox" checked> 복수선택 허용</label>
        <button id="voteBtn" class="small" disabled>투표하기</button>
        <button id="viewBtn" class="small" type="button">결과 보기</button>
        <button id="resetBtn" class="small" type="button">내 투표 초기화</button>
      </div>

      <div id="results" class="results" style="display:none;margin-top:16px"></div>
    </section>

    <footer>이 설문에 참여해 주셔서 감사합니다.</footer>
  </div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script>
// ===== Firebase 설정 =====
const firebaseConfig = {
  apiKey: "AIzaSyDI6VGnM5xPSNZX8T5W-meWeDI7-VXof1U",
  authDomain: "pleasevote-ff2c5.firebaseapp.com",
  projectId: "pleasevote-ff2c5",
  storageBucket: "pleasevote-ff2c5.firebasestorage.app",
  messagingSenderId: "759303245158",
  appId: "1:759303245158:web:464ba518290af1770a4ca7",
  measurementId: "G-BZBQW3SKJS"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== 투표 항목 =====
const OPTIONS = [
  { id: "halam.store", label: "halam.store", price: "550원" },
  { id: "halam.site",  label: "halam.site",  price: "2750원" },
  { id: "halam.xzy",   label: "halam.xzy",   price: "3300원" },
  { id: "halam.cloud", label: "halam.cloud", price: "2750원" },
  { id: "halam.my",    label: "halam.my",    price: "3300원" }
];

const $form = document.getElementById("pollForm");
const $voteBtn = document.getElementById("voteBtn");
const $allowMulti = document.getElementById("allowMulti");
const $viewBtn = document.getElementById("viewBtn");
const $resetBtn = document.getElementById("resetBtn");
const $results = document.getElementById("results");

const USER_KEY = "firestore_user_vote_v1";

// ====== UI 생성 ======
function initForm(){
  $form.innerHTML = "";
  OPTIONS.forEach(opt=>{
    const id = "opt-"+opt.id;
    const label = document.createElement("label");
    label.className = "option";
    label.htmlFor = id;

    const input = document.createElement("input");
    input.type = "checkbox";
    input.id = id;
    input.name = "vote";
    input.value = opt.id;
    input.addEventListener("change", updateVoteButtonState);

    const wrap = document.createElement("div");
    wrap.className = "opt-text";
    wrap.innerHTML = `
      <div>
        <div class="domain">${opt.label}</div>
        <div class="price">${opt.price}</div>
      </div>`;

    label.appendChild(input);
    label.appendChild(wrap);
    $form.appendChild(label);
  });
}
initForm();

function updateVoteButtonState(){
  const anyChecked = Array.from(document.querySelectorAll('input[name="vote"]')).some(b=>b.checked);
  $voteBtn.disabled = !anyChecked;
}

// ===== Firestore에서 투표 데이터 로드 =====
async function loadVotes(){
  const docRef = db.collection("votes").doc("domain_vote");
  const snap = await docRef.get();
  if(!snap.exists){
    const init = {};
    OPTIONS.forEach(o=>init[o.id]=0);
    await docRef.set(init);
    return init;
  }
  return snap.data();
}

// ===== Firestore에 저장 =====
async function saveVotes(v){
  const docRef = db.collection("votes").doc("domain_vote");
  await docRef.set(v);
}

// ===== 투표 =====
document.getElementById("voteBtn").addEventListener("click", async ()=>{
  const user = JSON.parse(localStorage.getItem(USER_KEY) || "null");
  if(user){
    alert("이미 투표했습니다!");
    return;
  }

  const checked = Array.from(document.querySelectorAll('input[name="vote"]:checked')).map(i=>i.value);
  if(checked.length === 0) return;

  const votes = await loadVotes();
  checked.forEach(id=> votes[id] += 1);
  await saveVotes(votes);

  localStorage.setItem(USER_KEY, JSON.stringify(checked));

  alert("투표가 저장되었습니다!");
});

// ===== 결과 보기 =====
document.getElementById("viewBtn").addEventListener("click", async ()=>{
  const votes = await loadVotes();
  renderResults(votes);
});

function renderResults(votes){
  $results.innerHTML = "";
  $results.style.display = "block";

  const total = Object.values(votes).reduce((a,b)=>a+b,0);

  OPTIONS.forEach(opt=>{
    const count = votes[opt.id];
    const percent = total === 0 ? 0 : Math.round((count/total)*100);

    const row = document.createElement("div");
    row.className = "bar-wrap";

    row.innerHTML = `
      <div class="bar-label">${opt.label}</div>
      <div class="bar">
        <div class="bar-fill" style="width:${percent}%"></div>
      </div>
      <div class="bar-value">${count}표 (${percent}%)</div>
    `;

    $results.appendChild(row);
  });
}

// ===== 투표 초기화 (내 기기만) =====
$resetBtn.addEventListener("click", ()=>{
  localStorage.removeItem(USER_KEY);
  document.querySelectorAll('input[name="vote"]').forEach(b=>b.checked=false);
  updateVoteButtonState();
  alert("내 투표 기록을 초기화했습니다.");
});
</script>

</body>
</html>
